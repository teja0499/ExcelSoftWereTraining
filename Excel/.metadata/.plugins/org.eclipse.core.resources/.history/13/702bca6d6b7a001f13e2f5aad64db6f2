package register;

import java.io.FileOutputStream;
import java.io.IOException;
import java.time.format.DateTimeFormatter;
import java.util.List;
import java.util.Random;

import javax.servlet.ServletContext;

import org.apache.poi.hssf.usermodel.HSSFCellStyle;
import org.apache.poi.hssf.usermodel.HSSFFont;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.hssf.util.HSSFColor;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.CellStyle;
import org.apache.poi.ss.usermodel.Font;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.struts2.ServletActionContext;

public class Genrate_ExcelFile {

//	private String excelLink;
	private String fileName;
	private String name;
	private List<User> users;
	
	
	
	

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public String getFileName() {
		return fileName;
	}

	public void setFileName(String fileName) {
		this.fileName = fileName;
	}

//	public String getExcelLink() {
//		System.out.println(excelLink);
//		return excelLink;
//	}
//
//	public void setExcelLink(String excelLink) {
//		this.excelLink = excelLink;
//	}
	
	
	public String formatDate(String date) {
		 DateTimeFormatter myFormatObj = DateTimeFormatter.ofPattern("09/24/2024");
		 System.out.println(myFormatObj);
		 return "";
	}

	public String genrateExcel() {
		System.out.println("Genrate_ExcelFile start");
		System.out.println("name :- "+name);
		if(name.length()!=0)
		{
			SearchFunction dataByName=new SearchFunction();
			users=dataByName.searchByName(name);
		}else 
		{
			Get allUser = new Get();
			users = allUser.getAll();
		}
		
		
		
		
		
		
		String Header[] = { "ID", " Name", "Email", "Mobile", "DOB", "Gender", "Qualification", "Password" };
		Workbook workbook = new HSSFWorkbook();

		CellStyle headerStyle = workbook.createCellStyle();
		Font font = workbook.createFont();
		font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);
		headerStyle.setFont(font);

		headerStyle.setFillForegroundColor(HSSFColor.BRIGHT_GREEN.index);
		headerStyle.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND);

		headerStyle.setBorderTop(CellStyle.BORDER_THICK);
		headerStyle.setBorderBottom(CellStyle.BORDER_THICK);
		headerStyle.setBorderLeft(CellStyle.BORDER_THICK);
		headerStyle.setBorderRight(CellStyle.BORDER_THICK);

		Sheet sheet = workbook.createSheet();
		Row row = sheet.createRow(0);
		sheet.createFreezePane(0, 1);
		formatDate("");

		for (int i = 0; i < Header.length; i++) {
			Cell cell = row.createCell(i);
			cell.setCellValue(Header[i]);
			cell.setCellStyle(headerStyle);
		}

		for (int i = 1; i <= users.size(); i++) {
			row = sheet.createRow(i);
			row.createCell(0).setCellValue(users.get(i - 1).getId());
			row.createCell(1).setCellValue(users.get(i - 1).getName());
			row.createCell(2).setCellValue(users.get(i - 1).getEmail());
			row.createCell(3).setCellValue(users.get(i - 1).getMobile());
			row.createCell(4).setCellValue(users.get(i - 1).getDob());
			row.createCell(5).setCellValue(users.get(i - 1).getGender());
			row.createCell(6).setCellValue(users.get(i - 1).getQualification());
			
		}

//		Random random = new Random();
//		int number = random.nextInt(1000000000);

		String path = ServletActionContext.getServletContext().getRealPath("/ExcelFiles/");
		String finalPath = path + fileName + ".xls";

		System.out.println("name :- "+name);
		System.out.println(finalPath);

//		String path="C:\\Users\\canncopierservicepvt\\Desktop\\Excel files\\"+number+".xls";

		try (FileOutputStream fileOut = new FileOutputStream(finalPath)) {
			workbook.write(fileOut);
			System.out.println("Excel file has been created successfully.");
//			setExcelLink(finalPath);
			System.out.println("Genrate_ExcelFile end");
			return "success";
		} catch (IOException e) {
			e.printStackTrace();
		}
		return "";

	}
}
